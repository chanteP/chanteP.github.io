---
layout: page
---
<div data-page="blog" class="page_blog">
    <style>.page_blog{min-height:100%;background:#EAEAEA}.page_blog .blog_list{padding:0 9px 100px 9px}.page_blog .blog_list [data-node="postlist"]{overflow:hidden}.page_blog .blog_list [data-node="postlist"] article{position:relative;margin:9px 9px;padding:20px;background:white;line-height:1.8}.page_blog .blog_list [data-node="postlist"] article .title{text-decoration:none}.page_blog .blog_list [data-node="postlist"] article .title h1{font-size:24px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.page_blog .blog_list [data-node="postlist"] .infobox{border-top:1px solid #ccc}.page_blog .blog_list [data-node="postlist"] .info{color:#a1a1a1;padding:8px}.page_blog .blog_list [data-node="postlist"] .content{color:#666;line-height:2;min-height:4em;max-height:4em;overflow:hidden;-webkit-transition:all 0.2s ease 0s;-moz-transition:all 0.2s ease 0s;transition:all 0.2s ease 0s}.page_blog .blog_list [data-node="postlist"] .content p{text-indent:2em}.page_blog .blog_list [data-node="postlist"] .content a,.page_blog .blog_list [data-node="postlist"] .more a{color:#48D3CE}.page_blog .blog_list [data-node="postlist"] .content a:hover,.page_blog .blog_list [data-node="postlist"] .more a:hover{color:#FE7F57}.page_blog .blog_list [data-node="postlist"] .more{text-align:right}.page_blog .blog_list [data-node="postlist"] .more [data-fake]:after{content:'全部展开'}.page_blog .blog_list [data-node="postlist"] .more [data-act="toTop"]{display:none}.page_blog .blog_list [data-node="postlist"][data-status="loading"],.page_blog .blog_list [data-node="postlist"][data-status="show"]{}.page_blog .blog_list [data-node="postlist"][data-status="show"] .content{max-height:200em}.page_blog .blog_list [data-node="postlist"][data-status="show"] .more [data-fake]:after{content:'收起'}.page_blog .blog_list [data-node="postlist"][data-status="show"] .more [data-act="toTop"]{display:inline-block}.page_blog .blog_list [data-node="postlist"] article:after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;visibility:hidden;-webkit-transition:all 0.2s ease 0s;-moz-transition:all 0.2s ease 0s;transition:all 0.2s ease 0s}.page_blog .blog_list [data-node="postlist"][data-status="loading"] article:after{opacity:1;visibility:visible;background:url('/static/images/progressing.gif') center center rgba(255,255,255,0.75) no-repeat}</style>
    <section class="wrap">
        <ul class="blog_list">
        {% for post in site.posts %}
            <li data-node="postlist" data-status data-url="#!{{ post.url }}">
                <article>
                    <a href="{{ post.url }}" class="title" data-fake="/blog#!{{ post.url }}" data-act="loadBlog">
                        <h1 title="{{ post.title }}">{{ post.title }}</h1>
                    </a>
                    <fieldset class="infobox">
                        <legend class="info">{{ post.date | date_to_string }}</legend>
                    </fieldset>
                    <div class="content" data-node="content">
                        <p>{{ post.content | strip_html | truncate : 110 | escape_once | append:'...'}}</p>
                    </div>
                    <p class="more">
                        <a href="{{ post.url }}" data-fake="/blog#!{{ post.url }}" data-act="loadBlog"></a>
                        <a href="javascript:;" data-act="toTop">回到顶部</a>
                    </p>
                </article>
            </li>
        {% endfor %}
        </ul>
    </section>
    <script>window.parent.core.initPage(document, function(wrap, $, window){
    var bindUrl = window.core.on;
    var D = window.DataBind;
    var wrapper = $.find('#wrapper');

    var storage = {};

    var Post = function(node, url){
        this.url = url;

        this.node = node;
        this.contentNode = $.find('[data-node="content"]', node);

        this.status = this.WAITING;
        this.mark = this.node.dataset.url;
        this.toggle();
    }
    Post.prototype = {
        WAITING : 'waiting',
        LOADING : 'loading',
        LOADED : 'loaded',
        AUTOHIDE : 'autohide',
        ERROR : 'error',
        HIDE : 'hide',
        SHOW : 'show',

        set status(value){
            this.cacheStatus = value;
            this.node.dataset.status = value;
            return value;
        },
        get status(){
            return this.cacheStatus;
        },

        load : function(){
            this.status = this.LOADING;
            $.iLoad(this.url, this.getContent.bind(this), this.loadFail.bind(this));
        },
        getContent : function(i){
            this.status = this.LOADED;
            try{
                this.contentNode.innerHTML = i.contentWindow.document.getElementById('content').innerHTML;
            }catch(e){}
            this.status = this.SHOW;
        },
        loadFail : function(){
            this.status = this.ERROR;
        },
        scrollTo : function(){
            var padding = window.getComputedStyle(wrap);
            padding = padding ? parseInt(padding['padding-top']) : 0;
            $.scrollTo(this.node.offsetTop + padding + 8, wrapper);
        },
        toggle : function(){
            this.scrollTo();
            if(this.status === this.ERROR || this.status === this.WAITING){
                this.load();
                return;
            }
            switch (this.status){
                case this.LOADED : ;
                case this.AUTOHIDE : ;
                case this.HIDE : 
                    this.status = this.SHOW;
                    break;
                case this.SHOW :
                    this.status = this.HIDE;
                    break;
                default : 
                    break;
            }

            var self = this;
            setTimeout(function(){
                [].forEach.call($.findAll('[data-fake]', this.node), function(btn){
                    btn.dataset.fake = '/blog' + (self.status === self.SHOW ? '' : self.mark);
                });
            }, 0);
        }
    }
    var togglePost = function(e){
        var unitDOM;
        if(!e){return;}
        if(e.toString().slice(-8) === "Element]"){
            unitDOM = e;
        }
        else{
            e.preventDefault()
            unitDOM = $.parent(this, '[data-node="postlist"]');
        }
        var url = unitDOM.dataset.url.slice(2);
        if(!storage[url]){
            storage[url] = new Post(unitDOM, url);
        }
        else{
            storage[url].toggle();
        }
    }
    // init()
    return {
        init : function(){
            $.evt(wrap)
                // .on('click', function(){alert(2424534)})
                .on('click', '[data-act="loadBlog"]', togglePost)
                .on('click', '[data-act="toTop"]', function(){
                    storage[$.parent(this, '[data-node="postlist"]').dataset.url.slice(2)].scrollTo();
                });
        },
        show : function(){
            var checkHash = location.hash, artical;
            if(String(checkHash).length > 8){
                var artical = $.find('[data-url="'+checkHash+'"]', wrap);
                togglePost(artical);
            }
        }
    }
});</script>
</div>